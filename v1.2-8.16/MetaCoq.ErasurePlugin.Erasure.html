<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">Library MetaCoq.ErasurePlugin.Erasure</h1>

<div class="code">
<span class="comment">(*&nbsp;Distributed&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;MIT&nbsp;license.&nbsp;*)</span><br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Program.Program.html#"><span class="id" title="library">Program</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.ssr.ssreflect.html#"><span class="id" title="library">ssreflect</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.ssr.ssrbool.html#"><span class="id" title="library">ssrbool</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Utils.utils.html#"><span class="id" title="library">utils</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Common</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Common.Transform.html#"><span class="id" title="library">Transform</span></a> <a class="idref" href="MetaCoq.Common.config.html#"><span class="id" title="library">config</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Template</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Template.EtaExpand.html#"><span class="id" title="library">EtaExpand</span></a> <a class="idref" href="MetaCoq.Template.TemplateProgram.html#"><span class="id" title="library">TemplateProgram</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.PCUIC</span> <span class="id" title="keyword">Require</span> <a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#"><span class="id" title="library">PCUICAst</span></a> <a class="idref" href="MetaCoq.PCUIC.utils.PCUICAstUtils.html#"><span class="id" title="library">PCUICAstUtils</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#"><span class="id" title="library">PCUICProgram</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.SafeChecker</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.SafeChecker.PCUICErrors.html#"><span class="id" title="library">PCUICErrors</span></a> <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#"><span class="id" title="library">PCUICWfEnvImpl</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure</span> <span class="id" title="keyword">Require</span> <a class="idref" href="MetaCoq.Erasure.EAstUtils.html#"><span class="id" title="library">EAstUtils</span></a> <a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#"><span class="id" title="library">ErasureFunction</span></a> <a class="idref" href="MetaCoq.Erasure.ErasureCorrectness.html#"><span class="id" title="library">ErasureCorrectness</span></a> <a class="idref" href="MetaCoq.Erasure.EPretty.html#"><span class="id" title="library">EPretty</span></a> <a class="idref" href="MetaCoq.Erasure.Extract.html#"><span class="id" title="library">Extract</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.ErasurePlugin</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#"><span class="id" title="library">ETransform</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#"><span class="id" title="module">PCUICProgram</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.TemplatePCUIC.PCUICTransform.html#"><span class="id" title="module">PCUICTransform</span></a> (<span class="id" title="var">template_to_pcuic_transform</span>, <span class="id" title="var">pcuic_expand_lets_transform</span>).<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Utils.bytestring.html#"><span class="id" title="module">bytestring</span></a>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">bs</span>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">string_scope2</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;is&nbsp;the&nbsp;total&nbsp;erasure&nbsp;function&nbsp;+<br/>
&nbsp;&nbsp;let-expansion&nbsp;of&nbsp;constructor&nbsp;arguments&nbsp;and&nbsp;case&nbsp;branches&nbsp;+<br/>
&nbsp;&nbsp;shrinking&nbsp;of&nbsp;the&nbsp;global&nbsp;environment&nbsp;dependencies&nbsp;+<br/>
&nbsp;&nbsp;the&nbsp;optimization&nbsp;that&nbsp;removes&nbsp;all&nbsp;pattern-matches&nbsp;on&nbsp;propositions.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Common.Transform.html#Transform"><span class="id" title="module">Transform</span></a>.<br/>

<br/>
<span class="id" title="keyword">Obligation</span> <span class="id" title="keyword">Tactic</span> := <span class="id" title="tactic">program_simpl</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">extraction_checker_flags</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">PCUICSN.extraction_normalizing</span>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#"><span class="id" title="module">EWcbvEval</span></a>.<br/>

<br/>
<span class="id" title="keyword">Axiom</span> <a id="assume_welltyped_template_program_expansion" class="idref" href="#assume_welltyped_template_program_expansion"><span class="id" title="axiom">assume_welltyped_template_program_expansion</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="p:1" class="idref" href="#p:1"><span class="id" title="binder">p</span></a> (<a id="wtp:2" class="idref" href="#wtp:2"><span class="id" title="binder">wtp</span></a> : <a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.Template.TemplateProgram.html#wt_template_program_env"><span class="id" title="definition">wt_template_program_env</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:1"><span class="id" title="variable">p</span></a> <a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a>),<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="p':3" class="idref" href="#p':3"><span class="id" title="binder">p'</span></a> := <a class="idref" href="MetaCoq.Template.EtaExpand.html#eta_expand_program"><span class="id" title="definition">EtaExpand.eta_expand_program</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:1"><span class="id" title="variable">p</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.Template.TemplateProgram.html#wt_template_program"><span class="id" title="definition">wt_template_program</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p':3"><span class="id" title="variable">p'</span></a> <a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Template.EtaExpand.html#expanded_program"><span class="id" title="definition">EtaExpand.expanded_program</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p':3"><span class="id" title="variable">p'</span></a>.<br/>

<br/>
<span class="id" title="keyword">Axiom</span> <a id="assume_preservation_template_program_env_expansion" class="idref" href="#assume_preservation_template_program_env_expansion"><span class="id" title="axiom">assume_preservation_template_program_env_expansion</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="p:5" class="idref" href="#p:5"><span class="id" title="binder">p</span></a> (<a id="wtp:6" class="idref" href="#wtp:6"><span class="id" title="binder">wtp</span></a> : <a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.Template.TemplateProgram.html#wt_template_program_env"><span class="id" title="definition">wt_template_program_env</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:5"><span class="id" title="variable">p</span></a> <a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a>) <a id="v:7" class="idref" href="#v:7"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.TemplateProgram.html#eval_template_program_env"><span class="id" title="definition">eval_template_program_env</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:5"><span class="id" title="variable">p</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#v:7"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.Template.TemplateProgram.html#eval_template_program"><span class="id" title="definition">eval_template_program</span></a> (<a class="idref" href="MetaCoq.Template.EtaExpand.html#eta_expand_program"><span class="id" title="definition">EtaExpand.eta_expand_program</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:5"><span class="id" title="variable">p</span></a>) (<a class="idref" href="MetaCoq.Template.EtaExpand.html#eta_expand"><span class="id" title="definition">EtaExpand.eta_expand</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:5"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#v:7"><span class="id" title="variable">v</span></a>) <a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a>.<br/>

<br/>
</div>

<div class="doc">
We kludge the normalization assumptions by parameterizing over a continuation of "what will be done to the program later" as well as what properties we'll need of it 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="eta_expand" class="idref" href="#eta_expand"><span class="id" title="definition">eta_expand</span></a> <a id="K:9" class="idref" href="#K:9"><span class="id" title="binder">K</span></a> : <a class="idref" href="MetaCoq.Common.Transform.html#Transform.t"><span class="id" title="record">Transform.t</span></a> <a class="idref" href="MetaCoq.Template.TemplateProgram.html#template_program_env"><span class="id" title="definition">template_program_env</span></a> <a class="idref" href="MetaCoq.Template.TemplateProgram.html#template_program"><span class="id" title="definition">template_program</span></a> <a class="idref" href="MetaCoq.Template.Ast.html#term"><span class="id" title="inductive">Ast.term</span></a> <a class="idref" href="MetaCoq.Template.Ast.html#term"><span class="id" title="inductive">Ast.term</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.TemplateProgram.html#eval_template_program_env"><span class="id" title="definition">eval_template_program_env</span></a> <a class="idref" href="MetaCoq.Template.TemplateProgram.html#eval_template_program"><span class="id" title="definition">eval_template_program</span></a> :=<br/>
&nbsp;&nbsp;{| <a class="idref" href="MetaCoq.Common.Transform.html#Transform.name"><span class="id" title="projection">name</span></a> := "eta expand cstrs and fixpoints";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Common.Transform.html#Transform.pre"><span class="id" title="projection">pre</span></a> := <span class="id" title="keyword">fun</span> <a id="p:10" class="idref" href="#p:10"><span class="id" title="binder">p</span></a> ⇒ <a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.Template.TemplateProgram.html#wt_template_program_env"><span class="id" title="definition">wt_template_program_env</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:10"><span class="id" title="variable">p</span></a> <a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#K:9"><span class="id" title="variable">K</span></a> (<a class="idref" href="MetaCoq.Template.EtaExpand.html#eta_expand_global_env"><span class="id" title="definition">eta_expand_global_env</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:10"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Common.Transform.html#Transform.transform"><span class="id" title="projection">transform</span></a> <a id="p:11" class="idref" href="#p:11"><span class="id" title="binder">p</span></a> <span class="id" title="var">_</span> := <a class="idref" href="MetaCoq.Template.EtaExpand.html#eta_expand_program"><span class="id" title="definition">EtaExpand.eta_expand_program</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:11"><span class="id" title="variable">p</span></a> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Common.Transform.html#Transform.post"><span class="id" title="projection">post</span></a> := <span class="id" title="keyword">fun</span> <a id="p:12" class="idref" href="#p:12"><span class="id" title="binder">p</span></a> ⇒ <a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="MetaCoq.Template.TemplateProgram.html#wt_template_program"><span class="id" title="definition">wt_template_program</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:12"><span class="id" title="variable">p</span></a> <a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.Template.EtaExpand.html#expanded_program"><span class="id" title="definition">EtaExpand.expanded_program</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:12"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#K:9"><span class="id" title="variable">K</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:12"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MetaCoq.Common.Transform.html#Transform.obseq"><span class="id" title="projection">obseq</span></a> <a id="p:13" class="idref" href="#p:13"><span class="id" title="binder">p</span></a> <a id="p':14" class="idref" href="#p':14"><span class="id" title="binder">p'</span></a> <a id="v:15" class="idref" href="#v:15"><span class="id" title="binder">v</span></a> <a id="v':16" class="idref" href="#v':16"><span class="id" title="binder">v'</span></a> := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#v':16"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MetaCoq.Template.EtaExpand.html#eta_expand"><span class="id" title="definition">EtaExpand.eta_expand</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:13"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#v:15"><span class="id" title="variable">v</span></a> |}.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">p</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">H</span> : <a class="idref" href="MetaCoq.Template.TemplateProgram.html#template_program_env"><span class="id" title="definition">template_program_env</span></a> |- <span class="id" title="var">_</span> ⇒ <span class="id" title="var">H</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">split</span>; [|<span class="id" title="tactic">split</span>]; <span class="id" title="tactic">auto</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#assume_welltyped_template_program_expansion"><span class="id" title="axiom">assume_welltyped_template_program_expansion</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span> <span class="id" title="var">v</span> [<span class="id" title="var">wt</span>] <span class="id" title="var">ev</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#assume_preservation_template_program_env_expansion"><span class="id" title="axiom">assume_preservation_template_program_env_expansion</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">ev</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">ev'</span>]; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="erasure_pipeline" class="idref" href="#erasure_pipeline"><span class="id" title="definition">erasure_pipeline</span></a> {<a id="guard:17" class="idref" href="#guard:17"><span class="id" title="binder">guard</span></a> : <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#abstract_guard_impl"><span class="id" title="class">abstract_guard_impl</span></a>} (<a id="efl:18" class="idref" href="#efl:18"><span class="id" title="binder">efl</span></a> := <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">EWellformed.all_env_flags</span></a>) :<br/>
&nbsp;<a class="idref" href="MetaCoq.Common.Transform.html#Transform.t"><span class="id" title="record">Transform.t</span></a> <a class="idref" href="MetaCoq.Template.TemplateProgram.html#template_program"><span class="id" title="definition">TemplateProgram.template_program</span></a> <a class="idref" href="MetaCoq.Erasure.EProgram.html#eprogram"><span class="id" title="definition">EProgram.eprogram</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.Ast.html#term"><span class="id" title="inductive">Ast.term</span></a> <a class="idref" href="MetaCoq.Erasure.EAst.html#term"><span class="id" title="inductive">EAst.term</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.TemplateProgram.html#eval_template_program"><span class="id" title="definition">TemplateProgram.eval_template_program</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="MetaCoq.Erasure.EProgram.html#eval_eprogram"><span class="id" title="definition">EProgram.eval_eprogram</span></a> {| <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#with_prop_case"><span class="id" title="method">with_prop_case</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>; <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#with_guarded_fix"><span class="id" title="method">with_guarded_fix</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>; <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#with_constructor_as_block"><span class="id" title="method">with_constructor_as_block</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> |}) :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;a&nbsp;bunch&nbsp;of&nbsp;nonsense&nbsp;for&nbsp;normalization&nbsp;preconditions&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="K:23" class="idref" href="#K:23"><span class="id" title="binder">K</span></a> <a id="ty:19" class="idref" href="#ty:19"><span class="id" title="binder">ty</span></a> (<a id="T:20" class="idref" href="#T:20"><span class="id" title="binder">T</span></a> : <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#ty:19"><span class="id" title="variable">ty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="var">_</span>) <a id="p:21" class="idref" href="#p:21"><span class="id" title="binder">p</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">let</span> <a id="p:22" class="idref" href="#p:22"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T:20"><span class="id" title="variable">T</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:21"><span class="id" title="variable">p</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf_ext"><span class="id" title="class">PCUICTyping.wf_ext</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:22"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICSN.html#NormalizationIn"><span class="id" title="class">PCUICSN.NormalizationIn</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:22"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf_ext"><span class="id" title="class">PCUICTyping.wf_ext</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:22"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICWeakeningEnvSN.html#normalizationInAdjustUniversesIn"><span class="id" title="class">PCUICWeakeningEnvSN.normalizationInAdjustUniversesIn</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:22"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="T1:25" class="idref" href="#T1:25"><span class="id" title="binder">T1</span></a> (<a id="p:24" class="idref" href="#p:24"><span class="id" title="binder">p</span></a>:<a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#global_env_ext_map"><span class="id" title="definition">global_env_ext_map</span></a>) := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:24"><span class="id" title="variable">p</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="T2:27" class="idref" href="#T2:27"><span class="id" title="binder">T2</span></a> (<a id="p:26" class="idref" href="#p:26"><span class="id" title="binder">p</span></a>:<a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#global_env_ext_map"><span class="id" title="definition">global_env_ext_map</span></a>) := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T1:25"><span class="id" title="variable">T1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#build_global_env_map"><span class="id" title="definition">build_global_env_map</span></a> (<a class="idref" href="MetaCoq.PCUIC.PCUICExpandLets.html#trans_global_env"><span class="id" title="definition">PCUICExpandLets.trans_global_env</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:26"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:26"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Utils.MCProd.html#::pair_scope:x_'.2'"><span class="id" title="notation">.2</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="T3:29" class="idref" href="#T3:29"><span class="id" title="binder">T3</span></a> (<a id="p:28" class="idref" href="#p:28"><span class="id" title="binder">p</span></a>:<a class="idref" href="MetaCoq.Template.Ast.html#Env.global_env"><span class="id" title="record">global_env</span></a>) := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T2:27"><span class="id" title="variable">T2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.TemplatePCUIC.TemplateToPCUIC.html#trans_global_env"><span class="id" title="definition">TemplateToPCUIC.trans_global_env</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:28"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="MetaCoq.Common.Universes.html#Monomorphic_ctx"><span class="id" title="constructor">Monomorphic_ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="T4:31" class="idref" href="#T4:31"><span class="id" title="binder">T4</span></a> (<a id="p:30" class="idref" href="#p:30"><span class="id" title="binder">p</span></a>:<a class="idref" href="MetaCoq.Template.TemplateEnvMap.html#GlobalEnvMap.t"><span class="id" title="record">GlobalEnvMap.t</span></a>) := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T3:29"><span class="id" title="variable">T3</span></a> (<a class="idref" href="MetaCoq.Template.EtaExpand.html#eta_expand_global_env"><span class="id" title="definition">eta_expand_global_env</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:30"><span class="id" title="variable">p</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Build&nbsp;an&nbsp;efficient&nbsp;lookup&nbsp;map&nbsp;for&nbsp;the&nbsp;following&nbsp;eta-expansion&nbsp;phase&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.TemplateProgram.html#build_template_program_env"><span class="id" title="definition">build_template_program_env</span></a> (<a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#K:23"><span class="id" title="variable">K</span></a> <span class="id" title="var">_</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T4:31"><span class="id" title="variable">T4</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Eta-expand&nbsp;constructors&nbsp;and&nbsp;fixpoint&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#eta_expand"><span class="id" title="definition">eta_expand</span></a> (<a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#K:23"><span class="id" title="variable">K</span></a> <span class="id" title="var">_</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T3:29"><span class="id" title="variable">T3</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Casts&nbsp;are&nbsp;removed,&nbsp;application&nbsp;is&nbsp;binary,&nbsp;case&nbsp;annotations&nbsp;are&nbsp;inferred&nbsp;from&nbsp;the&nbsp;global&nbsp;environment&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.TemplatePCUIC.PCUICTransform.html#template_to_pcuic_transform"><span class="id" title="definition">template_to_pcuic_transform</span></a> (<a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#K:23"><span class="id" title="variable">K</span></a> <span class="id" title="var">_</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T2:27"><span class="id" title="variable">T2</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Branches&nbsp;of&nbsp;cases&nbsp;are&nbsp;expanded&nbsp;to&nbsp;bind&nbsp;only&nbsp;variables,&nbsp;constructor&nbsp;types&nbsp;are&nbsp;expanded&nbsp;accordingly&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.TemplatePCUIC.PCUICTransform.html#pcuic_expand_lets_transform"><span class="id" title="definition">pcuic_expand_lets_transform</span></a> (<a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#K:23"><span class="id" title="variable">K</span></a> <span class="id" title="var">_</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T1:25"><span class="id" title="variable">T1</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Erasure&nbsp;of&nbsp;proofs&nbsp;terms&nbsp;in&nbsp;Prop&nbsp;and&nbsp;types&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#erase_transform"><span class="id" title="definition">erase_transform</span></a> <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Simulation&nbsp;of&nbsp;the&nbsp;guarded&nbsp;fixpoint&nbsp;rules&nbsp;with&nbsp;a&nbsp;single&nbsp;unguarded&nbsp;one:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;only&nbsp;"stuck"&nbsp;fixpoints&nbsp;remaining&nbsp;are&nbsp;unapplied.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;translation&nbsp;is&nbsp;a&nbsp;noop&nbsp;on&nbsp;terms&nbsp;and&nbsp;environments.&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#guarded_to_unguarded_fix"><span class="id" title="definition">guarded_to_unguarded_fix</span></a> (<span class="id" title="var">wcon</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a> <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Remove&nbsp;all&nbsp;constructor&nbsp;parameters&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#remove_params_optimization"><span class="id" title="definition">remove_params_optimization</span></a> (<span class="id" title="var">wcon</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Rebuild&nbsp;the&nbsp;efficient&nbsp;lookup&nbsp;table&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#rebuild_wf_env_transform"><span class="id" title="definition">rebuild_wf_env_transform</span></a> (<span class="id" title="var">efl</span> := <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#switch_no_params"><span class="id" title="definition">ERemoveParams.switch_no_params</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">EWellformed.all_env_flags</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Remove&nbsp;all&nbsp;cases&nbsp;/&nbsp;projections&nbsp;on&nbsp;propositional&nbsp;content&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#optimize_prop_discr_optimization"><span class="id" title="definition">optimize_prop_discr_optimization</span></a> (<span class="id" title="var">efl</span> := <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#switch_no_params"><span class="id" title="definition">ERemoveParams.switch_no_params</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">EWellformed.all_env_flags</span></a>) (<span class="id" title="var">wcon</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">hastrel</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">hastbox</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Rebuild&nbsp;the&nbsp;efficient&nbsp;lookup&nbsp;table&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#rebuild_wf_env_transform"><span class="id" title="definition">rebuild_wf_env_transform</span></a> (<span class="id" title="var">efl</span> := <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#switch_no_params"><span class="id" title="definition">ERemoveParams.switch_no_params</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">EWellformed.all_env_flags</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>  <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Inline&nbsp;projections&nbsp;to&nbsp;cases&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#inline_projections_optimization"><span class="id" title="definition">inline_projections_optimization</span></a> (<span class="id" title="var">fl</span> := <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#target_wcbv_flags"><span class="id" title="definition">EWcbvEval.target_wcbv_flags</span></a>) (<span class="id" title="var">wcon</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">hastrel</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">hastbox</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="efl:32" class="idref" href="#efl:32"><span class="id" title="binder">efl</span></a> := <a class="idref" href="MetaCoq.Erasure.EInlineProjections.html#disable_projections_env_flag"><span class="id" title="definition">EInlineProjections.disable_projections_env_flag</span></a> (<a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#switch_no_params"><span class="id" title="definition">ERemoveParams.switch_no_params</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">EWellformed.all_env_flags</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Rebuild&nbsp;the&nbsp;efficient&nbsp;lookup&nbsp;table&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#rebuild_wf_env_transform"><span class="id" title="definition">rebuild_wf_env_transform</span></a> (<span class="id" title="var">efl</span> :=  <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#efl:32"><span class="id" title="variable">efl</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;First-order&nbsp;constructor&nbsp;representation&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#constructors_as_blocks_transformation"><span class="id" title="definition">constructors_as_blocks_transformation</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#efl:32"><span class="id" title="variable">efl</span></a> (<span class="id" title="var">has_app</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">has_pars</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">has_cstrblocks</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>).<br/>

<br/>
<span class="comment">(*&nbsp;At&nbsp;the&nbsp;end&nbsp;of&nbsp;erasure&nbsp;we&nbsp;get&nbsp;a&nbsp;well-formed&nbsp;program&nbsp;(well-scoped&nbsp;globally&nbsp;and&nbsp;localy),&nbsp;without<br/>
&nbsp;&nbsp;&nbsp;parameters&nbsp;in&nbsp;inductive&nbsp;declarations.&nbsp;The&nbsp;constructor&nbsp;applications&nbsp;are&nbsp;also&nbsp;transformed&nbsp;to&nbsp;a&nbsp;first-order<br/>
&nbsp;&nbsp;&nbsp;"block"&nbsp;&nbsp;application,&nbsp;of&nbsp;the&nbsp;right&nbsp;length,&nbsp;and&nbsp;the&nbsp;evaluation&nbsp;relation&nbsp;does&nbsp;not&nbsp;need&nbsp;to&nbsp;consider&nbsp;guarded<br/>
&nbsp;&nbsp;&nbsp;fixpoints&nbsp;or&nbsp;case&nbsp;analyses&nbsp;on&nbsp;propositional&nbsp;content.&nbsp;All&nbsp;fixpoint&nbsp;bodies&nbsp;start&nbsp;with&nbsp;a&nbsp;lambda&nbsp;as&nbsp;well.<br/>
&nbsp;&nbsp;&nbsp;Finally,&nbsp;projections&nbsp;are&nbsp;inlined&nbsp;to&nbsp;cases,&nbsp;so&nbsp;no&nbsp;`tProj`&nbsp;remains.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.EGlobalEnv.html#"><span class="id" title="module">EGlobalEnv</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#"><span class="id" title="module">EWellformed</span></a>.<br/>

<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">split</span> ⇒ //. <span class="id" title="var">sq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#expanded_eprogram_env_expanded_eprogram_cstrs"><span class="id" title="lemma">ETransform.expanded_eprogram_env_expanded_eprogram_cstrs</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="run_erase_program" class="idref" href="#run_erase_program"><span class="id" title="definition">run_erase_program</span></a> {<a id="guard:33" class="idref" href="#guard:33"><span class="id" title="binder">guard</span></a> : <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#abstract_guard_impl"><span class="id" title="class">abstract_guard_impl</span></a>} := <a class="idref" href="MetaCoq.Common.Transform.html#Transform.run"><span class="id" title="definition">run</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#erasure_pipeline"><span class="id" title="definition">erasure_pipeline</span></a>.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="erasure_pipeline_fast" class="idref" href="#erasure_pipeline_fast"><span class="id" title="definition">erasure_pipeline_fast</span></a> {<a id="guard:34" class="idref" href="#guard:34"><span class="id" title="binder">guard</span></a> : <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#abstract_guard_impl"><span class="id" title="class">abstract_guard_impl</span></a>} (<a id="efl:35" class="idref" href="#efl:35"><span class="id" title="binder">efl</span></a> := <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">EWellformed.all_env_flags</span></a>) :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;a&nbsp;bunch&nbsp;of&nbsp;nonsense&nbsp;for&nbsp;normalization&nbsp;preconditions&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="K:40" class="idref" href="#K:40"><span class="id" title="binder">K</span></a> <a id="ty:36" class="idref" href="#ty:36"><span class="id" title="binder">ty</span></a> (<a id="T:37" class="idref" href="#T:37"><span class="id" title="binder">T</span></a> : <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#ty:36"><span class="id" title="variable">ty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="var">_</span>) <a id="p:38" class="idref" href="#p:38"><span class="id" title="binder">p</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">let</span> <a id="p:39" class="idref" href="#p:39"><span class="id" title="binder">p</span></a> := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T:37"><span class="id" title="variable">T</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:38"><span class="id" title="variable">p</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf_ext"><span class="id" title="class">PCUICTyping.wf_ext</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:39"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICSN.html#NormalizationIn"><span class="id" title="class">PCUICSN.NormalizationIn</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:39"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf_ext"><span class="id" title="class">PCUICTyping.wf_ext</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:39"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICWeakeningEnvSN.html#normalizationInAdjustUniversesIn"><span class="id" title="class">PCUICWeakeningEnvSN.normalizationInAdjustUniversesIn</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:39"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="T1:42" class="idref" href="#T1:42"><span class="id" title="binder">T1</span></a> (<a id="p:41" class="idref" href="#p:41"><span class="id" title="binder">p</span></a>:<a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#global_env_ext_map"><span class="id" title="definition">global_env_ext_map</span></a>) := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:41"><span class="id" title="variable">p</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="T2:44" class="idref" href="#T2:44"><span class="id" title="binder">T2</span></a> (<a id="p:43" class="idref" href="#p:43"><span class="id" title="binder">p</span></a>:<a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#global_env_ext_map"><span class="id" title="definition">global_env_ext_map</span></a>) := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T1:42"><span class="id" title="variable">T1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.PCUIC.PCUICProgram.html#build_global_env_map"><span class="id" title="definition">build_global_env_map</span></a> (<a class="idref" href="MetaCoq.PCUIC.PCUICExpandLets.html#trans_global_env"><span class="id" title="definition">PCUICExpandLets.trans_global_env</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:43"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:43"><span class="id" title="variable">p</span></a><a class="idref" href="MetaCoq.Utils.MCProd.html#::pair_scope:x_'.2'"><span class="id" title="notation">.2</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="T3:46" class="idref" href="#T3:46"><span class="id" title="binder">T3</span></a> (<a id="p:45" class="idref" href="#p:45"><span class="id" title="binder">p</span></a>:<a class="idref" href="MetaCoq.Template.Ast.html#Env.global_env"><span class="id" title="record">global_env</span></a>) := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T2:44"><span class="id" title="variable">T2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="MetaCoq.TemplatePCUIC.TemplateToPCUIC.html#trans_global_env"><span class="id" title="definition">TemplateToPCUIC.trans_global_env</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:45"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="MetaCoq.Common.Universes.html#Monomorphic_ctx"><span class="id" title="constructor">Monomorphic_ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="T4:48" class="idref" href="#T4:48"><span class="id" title="binder">T4</span></a> (<a id="p:47" class="idref" href="#p:47"><span class="id" title="binder">p</span></a>:<a class="idref" href="MetaCoq.Template.TemplateEnvMap.html#GlobalEnvMap.t"><span class="id" title="record">GlobalEnvMap.t</span></a>) := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T3:46"><span class="id" title="variable">T3</span></a> (<a class="idref" href="MetaCoq.Template.EtaExpand.html#eta_expand_global_env"><span class="id" title="definition">eta_expand_global_env</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:47"><span class="id" title="variable">p</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Template.TemplateProgram.html#build_template_program_env"><span class="id" title="definition">build_template_program_env</span></a> (<a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#K:40"><span class="id" title="variable">K</span></a> <span class="id" title="var">_</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T4:48"><span class="id" title="variable">T4</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#eta_expand"><span class="id" title="definition">eta_expand</span></a> (<a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#K:40"><span class="id" title="variable">K</span></a> <span class="id" title="var">_</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T3:46"><span class="id" title="variable">T3</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.TemplatePCUIC.PCUICTransform.html#template_to_pcuic_transform"><span class="id" title="definition">template_to_pcuic_transform</span></a> (<a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#K:40"><span class="id" title="variable">K</span></a> <span class="id" title="var">_</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T2:44"><span class="id" title="variable">T2</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.TemplatePCUIC.PCUICTransform.html#pcuic_expand_lets_transform"><span class="id" title="definition">pcuic_expand_lets_transform</span></a> (<a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#K:40"><span class="id" title="variable">K</span></a> <span class="id" title="var">_</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#T1:42"><span class="id" title="variable">T1</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#erase_transform"><span class="id" title="definition">erase_transform</span></a> <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#guarded_to_unguarded_fix"><span class="id" title="definition">guarded_to_unguarded_fix</span></a> (<span class="id" title="var">wcon</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a> <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#remove_params_fast_optimization"><span class="id" title="definition">remove_params_fast_optimization</span></a> (<span class="id" title="var">wcon</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>)  <span class="id" title="var">_</span> <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#rebuild_wf_env_transform"><span class="id" title="definition">rebuild_wf_env_transform</span></a> (<span class="id" title="var">efl</span> := <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#switch_no_params"><span class="id" title="definition">ERemoveParams.switch_no_params</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">EWellformed.all_env_flags</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#optimize_prop_discr_optimization"><span class="id" title="definition">optimize_prop_discr_optimization</span></a> (<span class="id" title="var">efl</span> := <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#switch_no_params"><span class="id" title="definition">ERemoveParams.switch_no_params</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">EWellformed.all_env_flags</span></a>) (<span class="id" title="var">wcon</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">hastrel</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">hastbox</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#rebuild_wf_env_transform"><span class="id" title="definition">rebuild_wf_env_transform</span></a> (<span class="id" title="var">efl</span> := <a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#switch_no_params"><span class="id" title="definition">ERemoveParams.switch_no_params</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">EWellformed.all_env_flags</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#inline_projections_optimization"><span class="id" title="definition">inline_projections_optimization</span></a> (<span class="id" title="var">fl</span> := <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#target_wcbv_flags"><span class="id" title="definition">EWcbvEval.target_wcbv_flags</span></a>) (<span class="id" title="var">wcon</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">hastrel</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">hastbox</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="efl:49" class="idref" href="#efl:49"><span class="id" title="binder">efl</span></a> := <a class="idref" href="MetaCoq.Erasure.EInlineProjections.html#disable_projections_env_flag"><span class="id" title="definition">EInlineProjections.disable_projections_env_flag</span></a> (<a class="idref" href="MetaCoq.Erasure.ERemoveParams.html#switch_no_params"><span class="id" title="definition">ERemoveParams.switch_no_params</span></a> <a class="idref" href="MetaCoq.Erasure.EWellformed.html#all_env_flags"><span class="id" title="definition">EWellformed.all_env_flags</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#rebuild_wf_env_transform"><span class="id" title="definition">rebuild_wf_env_transform</span></a> (<span class="id" title="var">efl</span> :=  <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#efl:49"><span class="id" title="variable">efl</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="MetaCoq.Common.Transform.html#41a41e67965da0db3deedf90048574e3"><span class="id" title="notation">▷</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#constructors_as_blocks_transformation"><span class="id" title="definition">constructors_as_blocks_transformation</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#efl:49"><span class="id" title="variable">efl</span></a> (<span class="id" title="var">has_app</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">has_pars</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>) (<span class="id" title="var">has_cstrblocks</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>).<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">split</span> ⇒ //. <span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.ErasurePlugin.ETransform.html#expanded_eprogram_env_expanded_eprogram_cstrs"><span class="id" title="lemma">ETransform.expanded_eprogram_env_expanded_eprogram_cstrs</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="run_erase_program_fast" class="idref" href="#run_erase_program_fast"><span class="id" title="definition">run_erase_program_fast</span></a> {<a id="guard:50" class="idref" href="#guard:50"><span class="id" title="binder">guard</span></a> : <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#abstract_guard_impl"><span class="id" title="class">abstract_guard_impl</span></a>} := <a class="idref" href="MetaCoq.Common.Transform.html#Transform.run"><span class="id" title="definition">run</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#erasure_pipeline_fast"><span class="id" title="definition">erasure_pipeline_fast</span></a>.<br/>

<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">string_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Axiom</span> <a id="fake_guard_impl_properties" class="idref" href="#fake_guard_impl_properties"><span class="id" title="axiom">fake_guard_impl_properties</span></a> :<br/>
<span class="id" title="keyword">∀</span> (<a id="fix_cofix:51" class="idref" href="#fix_cofix:51"><span class="id" title="binder">fix_cofix</span></a>: <a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#FixCoFix"><span class="id" title="inductive">PCUICTyping.FixCoFix</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="2419f67097a80bf54d8cab0e41eb773a" class="idref" href="#2419f67097a80bf54d8cab0e41eb773a"><span class="id" title="binder">Σ</span></a>: <a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#PCUICEnvironment.global_env_ext"><span class="id" title="definition">PCUICAst.PCUICEnvironment.global_env_ext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="6c48d2981cee562ec855ecfa4a686fde" class="idref" href="#6c48d2981cee562ec855ecfa4a686fde"><span class="id" title="binder">Γ</span></a>: <a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#PCUICEnvironment.context"><span class="id" title="definition">PCUICAst.PCUICEnvironment.context</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mfix:54" class="idref" href="#mfix:54"><span class="id" title="binder">mfix</span></a>: <a class="idref" href="MetaCoq.Common.BasicAst.html#mfixpoint"><span class="id" title="definition">BasicAst.mfixpoint</span></a> <a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#term"><span class="id" title="inductive">PCUICAst.term</span></a>),<br/>
<a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#guard"><span class="id" title="method">PCUICTyping.guard</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#fix_cofix:51"><span class="id" title="variable">fix_cofix</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#2419f67097a80bf54d8cab0e41eb773a"><span class="id" title="variable">Σ</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#6c48d2981cee562ec855ecfa4a686fde"><span class="id" title="variable">Γ</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#mfix:54"><span class="id" title="variable">mfix</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#fake_guard_impl"><span class="id" title="definition">fake_guard_impl</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#fix_cofix:51"><span class="id" title="variable">fix_cofix</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#2419f67097a80bf54d8cab0e41eb773a"><span class="id" title="variable">Σ</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#6c48d2981cee562ec855ecfa4a686fde"><span class="id" title="variable">Γ</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#mfix:54"><span class="id" title="variable">mfix</span></a>.<br/>

<br/>
<span class="id" title="keyword">Global</span> <span class="id" title="var">Program</span> <span class="id" title="keyword">Instance</span> <a id="fake_guard_impl" class="idref" href="#fake_guard_impl"><span class="id" title="instance">fake_guard_impl</span></a> : <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#abstract_guard_impl"><span class="id" title="class">abstract_guard_impl</span></a> :=<br/>
{| <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#guard_impl"><span class="id" title="method">guard_impl</span></a> := <a class="idref" href="MetaCoq.SafeChecker.PCUICWfEnvImpl.html#fake_guard_impl"><span class="id" title="definition">fake_guard_impl</span></a> |}.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#fake_guard_impl_properties"><span class="id" title="axiom">fake_guard_impl_properties</span></a>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Ideally we'd have a MetaCoq template program that generates a proof of Strong Normalization for the particular program we're erasing.  For now we just axiomatize SN. 
</div>
<div class="code">
<span class="id" title="keyword">Axiom</span> <a id="fake_normalization" class="idref" href="#fake_normalization"><span class="id" title="axiom">fake_normalization</span></a> : <a class="idref" href="MetaCoq.PCUIC.PCUICSN.html#Normalization"><span class="id" title="class">PCUICSN.Normalization</span></a>.<br/>
<span class="id" title="keyword">Global</span> <span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">fake_normalization</span>.<br/>

<br/>
</div>

<div class="doc">
This uses the retyping-based erasure and assumes that the global environment and term
  are welltyped (for speed). As such this should only be used for testing, or when we know that
  the environment is wellformed and the term well-typed (e.g. when it comes directly from a
  Coq definition). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Axiom</span> <a id="assume_that_we_only_erase_on_welltyped_programs" class="idref" href="#assume_that_we_only_erase_on_welltyped_programs"><span class="id" title="axiom">assume_that_we_only_erase_on_welltyped_programs</span></a> : <span class="id" title="keyword">∀</span> {<a id="cf:57" class="idref" href="#cf:57"><span class="id" title="binder">cf</span></a> : <a class="idref" href="MetaCoq.Common.config.html#checker_flags"><span class="id" title="class">checker_flags</span></a>},<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="p:58" class="idref" href="#p:58"><span class="id" title="binder">p</span></a> : <a class="idref" href="MetaCoq.Template.Ast.html#Env.program"><span class="id" title="definition">Ast.Env.program</span></a>), <a class="idref" href="MetaCoq.Utils.MCSquash.html#squash"><span class="id" title="record">squash</span></a> (<a class="idref" href="MetaCoq.Template.TemplateProgram.html#wt_template_program"><span class="id" title="definition">TemplateProgram.wt_template_program</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:58"><span class="id" title="variable">p</span></a>).<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="erase_and_print_template_program" class="idref" href="#erase_and_print_template_program"><span class="id" title="definition">erase_and_print_template_program</span></a> (<a id="p:60" class="idref" href="#p:60"><span class="id" title="binder">p</span></a> : <a class="idref" href="MetaCoq.Template.Ast.html#Env.program"><span class="id" title="definition">Ast.Env.program</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="MetaCoq.Utils.bytestring.html#string"><span class="id" title="abbreviation">string</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="p':61" class="idref" href="#p':61"><span class="id" title="binder">p'</span></a> := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#run_erase_program"><span class="id" title="definition">run_erase_program</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:60"><span class="id" title="variable">p</span></a> <span class="id" title="var">_</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Common.Transform.html#time"><span class="id" title="definition">time</span></a> "Pretty printing" <a class="idref" href="MetaCoq.Erasure.EPretty.html#print_program"><span class="id" title="definition">EPretty.print_program</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p':61"><span class="id" title="variable">p'</span></a>.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#assume_that_we_only_erase_on_welltyped_programs"><span class="id" title="axiom">assume_that_we_only_erase_on_welltyped_programs</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">cbv</span> [<a class="idref" href="MetaCoq.PCUIC.PCUICWeakeningEnvSN.html#normalizationInAdjustUniversesIn"><span class="id" title="class">PCUICWeakeningEnvSN.normalizationInAdjustUniversesIn</span></a>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> @<a class="idref" href="MetaCoq.PCUIC.PCUICSN.html#normalization"><span class="id" title="definition">PCUICSN.normalization</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="erase_fast_and_print_template_program" class="idref" href="#erase_fast_and_print_template_program"><span class="id" title="definition">erase_fast_and_print_template_program</span></a> (<a id="p:62" class="idref" href="#p:62"><span class="id" title="binder">p</span></a> : <a class="idref" href="MetaCoq.Template.Ast.html#Env.program"><span class="id" title="definition">Ast.Env.program</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="MetaCoq.Utils.bytestring.html#string"><span class="id" title="abbreviation">string</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="p':63" class="idref" href="#p':63"><span class="id" title="binder">p'</span></a> := <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#run_erase_program_fast"><span class="id" title="definition">run_erase_program_fast</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p:62"><span class="id" title="variable">p</span></a> <span class="id" title="var">_</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Common.Transform.html#time"><span class="id" title="definition">time</span></a> "pretty-printing" <a class="idref" href="MetaCoq.Erasure.EPretty.html#print_program"><span class="id" title="definition">EPretty.print_program</span></a> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#p':63"><span class="id" title="variable">p'</span></a>.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.ErasurePlugin.Erasure.html#assume_that_we_only_erase_on_welltyped_programs"><span class="id" title="axiom">assume_that_we_only_erase_on_welltyped_programs</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">cbv</span> [<a class="idref" href="MetaCoq.PCUIC.PCUICWeakeningEnvSN.html#normalizationInAdjustUniversesIn"><span class="id" title="class">PCUICWeakeningEnvSN.normalizationInAdjustUniversesIn</span></a>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> @<a class="idref" href="MetaCoq.PCUIC.PCUICSN.html#normalization"><span class="id" title="definition">PCUICSN.normalization</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
