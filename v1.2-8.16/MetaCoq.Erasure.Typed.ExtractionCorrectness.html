<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">Library MetaCoq.Erasure.Typed.ExtractionCorrectness</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure.Typed</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.Typed.ErasureCorrectness.html#"><span class="id" title="library">ErasureCorrectness</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure.Typed</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.Typed.ExAst.html#"><span class="id" title="library">ExAst</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure.Typed</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.Typed.Extraction.html#"><span class="id" title="library">Extraction</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure.Typed</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.Typed.Optimize.html#"><span class="id" title="library">Optimize</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure.Typed</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.Typed.OptimizeCorrectness.html#"><span class="id" title="library">OptimizeCorrectness</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure.Typed</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.Typed.ResultMonad.html#"><span class="id" title="library">ResultMonad</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure.Typed</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.Typed.WcbvEvalAux.html#"><span class="id" title="library">WcbvEvalAux</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="keyword">Equations</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Equations</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.ErasureCorrectness.html#"><span class="id" title="library">ErasureCorrectness</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#"><span class="id" title="library">ErasureFunction</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.EWcbvEval.html#"><span class="id" title="library">EWcbvEval</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Erasure</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Erasure.Extract.html#"><span class="id" title="library">Extract</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.PCUIC</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.PCUIC.utils.PCUICAstUtils.html#"><span class="id" title="library">PCUICAstUtils</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.PCUIC</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.PCUIC.PCUICSafeLemmata.html#"><span class="id" title="library">PCUICSafeLemmata</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.PCUIC</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#"><span class="id" title="library">PCUICTyping</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.PCUIC</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.PCUIC.PCUICInversion.html#"><span class="id" title="library">PCUICInversion</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Common</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Common.Kernames.html#"><span class="id" title="library">Kernames</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MetaCoq.Utils.utils.html#"><span class="id" title="library">utils</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Lists.List.html#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <a id="P" class="idref" href="#P"><span class="id" title="module">P</span></a> := <a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#"><span class="id" title="module">PCUICAst</span></a>.<br/>
<span class="id" title="keyword">Module</span> <a id="E" class="idref" href="#E"><span class="id" title="module">E</span></a> := <a class="idref" href="MetaCoq.Erasure.EAst.html#"><span class="id" title="module">EAst</span></a>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> <a id="0cb9631b9ab072cb900cf2fb3f66f9a2" class="idref" href="#0cb9631b9ab072cb900cf2fb3f66f9a2"><span class="id" title="notation">&quot;</span></a>Σ 'p⊢' s ⇓ t" := (<a class="idref" href="MetaCoq.PCUIC.PCUICWcbvEval.html#eval"><span class="id" title="inductive">PCUICWcbvEval.eval</span></a> <span class="id" title="var">Σ</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 50, <span class="id" title="var">s</span>, <span class="id" title="var">t</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>) : <span class="id" title="var">type_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wf_squash" class="idref" href="#wf_squash"><span class="id" title="lemma">wf_squash</span></a> {<a id="0101b9beac487b383a5ba2a8f6922788" class="idref" href="#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="binder">Σ</span></a>} :<br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a><a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf_ext"><span class="id" title="class">wf_ext</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a><a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a><a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf"><span class="id" title="class">wf</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a><a class="idref" href="MetaCoq.Utils.MCSquash.html#2403cb4f4230cf3f6910dd7542d09118"><span class="id" title="notation">∥</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> []. <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_env_In" class="idref" href="#lookup_env_In"><span class="id" title="lemma">lookup_env_In</span></a> <a id="d:2" class="idref" href="#d:2"><span class="id" title="binder">d</span></a> <a id="eb9571817dd417966f307c3a9de8fe7f" class="idref" href="#eb9571817dd417966f307c3a9de8fe7f"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf"><span class="id" title="class">wf</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#eb9571817dd417966f307c3a9de8fe7f"><span class="id" title="variable">Σ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#d:2"><span class="id" title="variable">d</span></a> (<a class="idref" href="MetaCoq.Erasure.Typed.Extraction.html#PEnv.declarations"><span class="id" title="projection">PEnv.declarations</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#eb9571817dd417966f307c3a9de8fe7f"><span class="id" title="variable">Σ</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="d':4" class="idref" href="#d':4"><span class="id" title="binder">d'</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#d':4"><span class="id" title="variable">d'</span></a> (<a class="idref" href="MetaCoq.Erasure.Typed.Extraction.html#PEnv.declarations"><span class="id" title="projection">PEnv.declarations</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#eb9571817dd417966f307c3a9de8fe7f"><span class="id" title="variable">Σ</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#d:2"><span class="id" title="variable">d</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#d':4"><span class="id" title="variable">d'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#d:2"><span class="id" title="variable">d</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#d':4"><span class="id" title="variable">d'</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span> <span class="id" title="keyword">Type</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Σ</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">univs</span> <span class="id" title="var">decls</span> <span class="id" title="var">retro</span>]; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">o</span> <span class="id" title="tactic">in</span> <span class="id" title="var">d</span> |- *; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">H</span>|<span class="id" title="var">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">d'</span> [<span class="id" title="var">H'</span>|<span class="id" title="var">H'</span>]; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o0</span> <span class="id" title="keyword">as</span> [<span class="id" title="tactic">fresh</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">kn</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#fresh_global_iff_not_In"><span class="id" title="lemma">P.fresh_global_iff_not_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="tactic">fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Lists.List.html#in_map"><span class="id" title="lemma">in_map</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a>) <span class="id" title="tactic">in</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">d'</span> [<span class="id" title="var">H'</span>|<span class="id" title="var">H'</span>] <span class="id" title="var">eq</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o0</span> <span class="id" title="keyword">as</span> [<span class="id" title="tactic">fresh</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#fresh_global_iff_not_In"><span class="id" title="lemma">P.fresh_global_iff_not_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="tactic">fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Lists.List.html#in_map"><span class="id" title="lemma">in_map</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_global_In_wf" class="idref" href="#lookup_global_In_wf"><span class="id" title="lemma">lookup_global_In_wf</span></a> <a id="d:5" class="idref" href="#d:5"><span class="id" title="binder">d</span></a> <a id="f525610baade8c1419220d275a93fff0" class="idref" href="#f525610baade8c1419220d275a93fff0"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf"><span class="id" title="class">wf</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#f525610baade8c1419220d275a93fff0"><span class="id" title="variable">Σ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#d:5"><span class="id" title="variable">d</span></a> (<a class="idref" href="MetaCoq.Erasure.Typed.Extraction.html#PEnv.declarations"><span class="id" title="projection">PEnv.declarations</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#f525610baade8c1419220d275a93fff0"><span class="id" title="variable">Σ</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ErasureCorrectness.html#P.lookup_global"><span class="id" title="definition">P.lookup_global</span></a> (<a class="idref" href="MetaCoq.Erasure.Typed.Extraction.html#PEnv.declarations"><span class="id" title="projection">PEnv.declarations</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#f525610baade8c1419220d275a93fff0"><span class="id" title="variable">Σ</span></a>) <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#d:5"><span class="id" title="variable">d</span></a><a class="idref" href="MetaCoq.Utils.MCProd.html#::pair_scope:x_'.1'"><span class="id" title="notation">.1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span> <span class="id" title="keyword">Type</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">wfΣ</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">d</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">kn</span> <span class="id" title="var">decl</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">hin</span>. <span class="id" title="tactic">eapply</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Lists.List.html#in_map"><span class="id" title="lemma">in_map</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a>) <span class="id" title="tactic">in</span> <span class="id" title="var">hin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">hne</span>; <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MetaCoq.Erasure.Typed.ErasureCorrectness.html#P.lookup_global_None"><span class="id" title="lemma">P.lookup_global_None</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">hne</span>. <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="global_erased_with_deps_erases_deps_tConst" class="idref" href="#global_erased_with_deps_erases_deps_tConst"><span class="id" title="lemma">global_erased_with_deps_erases_deps_tConst</span></a> <a id="0f7fdea5e8c25e3e1a79edf27e9de540" class="idref" href="#0f7fdea5e8c25e3e1a79edf27e9de540"><span class="id" title="binder">Σ</span></a> <a id="20f5a40dbf26134eddace4754b8af92e" class="idref" href="#20f5a40dbf26134eddace4754b8af92e"><span class="id" title="binder">Σer</span></a> <a id="kn:9" class="idref" href="#kn:9"><span class="id" title="binder">kn</span></a> <a id="cst:10" class="idref" href="#cst:10"><span class="id" title="binder">cst</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf"><span class="id" title="class">wf</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#0f7fdea5e8c25e3e1a79edf27e9de540"><span class="id" title="variable">Σ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#declared_constant"><span class="id" title="definition">P.declared_constant</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#0f7fdea5e8c25e3e1a79edf27e9de540"><span class="id" title="variable">Σ</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#kn:9"><span class="id" title="variable">kn</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#cst:10"><span class="id" title="variable">cst</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Erasure.ErasureFunction.html#global_erased_with_deps"><span class="id" title="definition">global_erased_with_deps</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#0f7fdea5e8c25e3e1a79edf27e9de540"><span class="id" title="variable">Σ</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#20f5a40dbf26134eddace4754b8af92e"><span class="id" title="variable">Σer</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#kn:9"><span class="id" title="variable">kn</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MetaCoq.Erasure.Extract.html#erases_deps"><span class="id" title="inductive">erases_deps</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#0f7fdea5e8c25e3e1a79edf27e9de540"><span class="id" title="variable">Σ</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#20f5a40dbf26134eddace4754b8af92e"><span class="id" title="variable">Σer</span></a> (<a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#tConst"><span class="id" title="constructor">E.tConst</span></a> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#kn:9"><span class="id" title="variable">kn</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="keyword">wf</span> <span class="id" title="var">decl</span> <span class="id" title="var">glob</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">glob</span> <span class="id" title="keyword">as</span> [(?&amp;?&amp;?&amp;?&amp;?&amp;?)|(?&amp;?&amp;?&amp;?&amp;?)].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#declared_constant"><span class="id" title="definition">P.declared_constant</span></a>, <a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#declared_minductive"><span class="id" title="definition">PCUICAst.declared_minductive</span></a> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#lookup_env_In"><span class="id" title="lemma">lookup_env_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">decl</span>; <span class="id" title="var">tea</span>. <span class="id" title="var">now</span> <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">decl</span>. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <a id="PEnv" class="idref" href="#PEnv"><span class="id" title="module">PEnv</span></a> := <a class="idref" href="MetaCoq.PCUIC.PCUICAst.html#PCUICEnvironment"><span class="id" title="module">PCUICAst.PCUICEnvironment</span></a>.<br/>

<br/>
<span class="comment">(*Lemma&nbsp;wf_erase_global_decl&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;(H&nbsp;:&nbsp;EWellformed.EEnvFlags)&nbsp;(k&nbsp;:&nbsp;kername)&nbsp;(g&nbsp;:&nbsp;PCUICAst.PCUICEnvironment.global_decl)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(decls&nbsp;:&nbsp;list&nbsp;(kername&nbsp;*&nbsp;PCUICAst.PCUICEnvironment.global_decl))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(univs&nbsp;:&nbsp;Universes.ContextSet.t)&nbsp;retros&nbsp;w&nbsp;wt&nbsp;(Σex&nbsp;:&nbsp;global_env),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;EWellformed.wf_glob&nbsp;(trans_env&nbsp;Σex)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;EWellformed.wf_global_decl<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(trans_env&nbsp;Σex)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(trans_global_decl<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Erasure.erase_global_decl<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({|&nbsp;PEnv.universes&nbsp;:=&nbsp;univs;&nbsp;PEnv.declarations&nbsp;:=&nbsp;decls;&nbsp;PEnv.retroknowledge&nbsp;:=&nbsp;retros&nbsp;|},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PCUICAst.PCUICLookup.universes_decl_of_decl&nbsp;g)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;k&nbsp;g&nbsp;wt))&nbsp;=&nbsp;true.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;H&nbsp;k&nbsp;g&nbsp;decls&nbsp;univs&nbsp;w&nbsp;wt&nbsp;Σex&nbsp;wf_global.<br/>
&nbsp;&nbsp;unfold&nbsp;Erasure.erase_global_decl.<br/>
&nbsp;&nbsp;destruct&nbsp;g.<br/>
&nbsp;&nbsp;-&nbsp;destruct&nbsp;(Erasure.erase_constant_decl)&nbsp;eqn:Hdecl.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;unfold&nbsp;Erasure.erase_constant_decl,Erasure.erase_constant_decl_clause_1&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(Erasure.flag_of_type),&nbsp;conv_ar;try&nbsp;congruence.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hdecl;subst;clear&nbsp;Hdecl.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;trans_global_decl,trans_cst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cbn.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;MCOption.option_default.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;global_erased_with_deps&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;erase_constant_body_correct''&nbsp;*)</span><br/>
Qed&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">invert_wf</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <a class="idref" href="MetaCoq.PCUIC.PCUICTyping.html#wf"><span class="id" title="class">wf</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] ⇒ <span class="id" title="var">sq</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>;<span class="id" title="tactic">subst</span>;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×<br/>
&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#on_global_decls"><span class="id" title="inductive">P.on_global_decls</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">_</span>) |- <span class="id" title="var">_</span>] ⇒ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>;<span class="id" title="tactic">subst</span>;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×<br/>
&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <a class="idref" href="MetaCoq.Erasure.Typed.ExtractionCorrectness.html#on_global_decls_data"><span class="id" title="record">P.on_global_decls_data</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] ⇒ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*<br/>
Lemma&nbsp;wf_erase_global_decls_recursive&nbsp;`{EWellformed.EEnvFlags}&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;decls&nbsp;univs&nbsp;retros&nbsp;w&nbsp;seeds&nbsp;(ignored&nbsp;:&nbsp;kername&nbsp;-&gt;&nbsp;bool),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;Σex&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Erasure.erase_global_decls_deps_recursive&nbsp;decls&nbsp;univs&nbsp;retros&nbsp;w&nbsp;seeds&nbsp;ignored&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;EWellformed.wf_glob&nbsp;(trans_env&nbsp;Σex).<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;decls&nbsp;univs&nbsp;retros&nbsp;w&nbsp;seeds&nbsp;ignored&nbsp;?.<br/>
&nbsp;&nbsp;subst&nbsp;Σex.<br/>
&nbsp;&nbsp;revert&nbsp;seeds.<br/>
&nbsp;&nbsp;induction&nbsp;decls;intros&nbsp;seeds;auto;try&nbsp;constructor.<br/>
&nbsp;&nbsp;simpl.<br/>
&nbsp;&nbsp;destruct&nbsp;a;simpl.<br/>
&nbsp;&nbsp;destruct&nbsp;(KernameSet.mem&nbsp;_&nbsp;_);cbn.<br/>
&nbsp;&nbsp;-&nbsp;unfold&nbsp;MCProd.test_snd;cbn.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;constructor.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;unfold&nbsp;trans_env&nbsp;in&nbsp;*;cbn&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;IHdecls.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;cbn.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remember&nbsp;(KernameSet.union&nbsp;_&nbsp;_)&nbsp;as&nbsp;kns.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Heqkns.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remember&nbsp;(Erasure.erase_global_decls_deps_recursive&nbsp;decls&nbsp;univs&nbsp;_&nbsp;_&nbsp;_&nbsp;_)&nbsp;as&nbsp;Σex.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(EWellformed.wf_glob&nbsp;(trans_env&nbsp;Σex))&nbsp;by&nbsp;now&nbsp;subst&nbsp;Σex.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now&nbsp;apply&nbsp;wf_erase_global_decl.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;sq.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;OptimizePropDiscr.trans_env_fresh_global.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;fresh_globals_erase_global_decl_rec.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;change&nbsp;decls&nbsp;with&nbsp;(PEnv.declarations<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|&nbsp;PEnv.universes&nbsp;:=&nbsp;univs;&nbsp;PEnv.declarations&nbsp;:=&nbsp;decls;&nbsp;PEnv.retroknowledge&nbsp;:=&nbsp;retros&nbsp;|}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;PCUICWfEnvImpl.wf_fresh_globals.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;invert_wf;split;auto;split;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;fresh_global_erase_global_decl_rec.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;change&nbsp;decls&nbsp;with&nbsp;(PEnv.declarations<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|&nbsp;PEnv.universes&nbsp;:=&nbsp;univs;&nbsp;PEnv.declarations&nbsp;:=&nbsp;decls;&nbsp;PEnv.retroknowledge&nbsp;:=&nbsp;retros&nbsp;|}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now&nbsp;repeat&nbsp;invert_wf.<br/>
&nbsp;&nbsp;-&nbsp;apply&nbsp;IHdecls.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;optimize_correct&nbsp;`{EWellformed.EEnvFlags}&nbsp;Σ&nbsp;fgΣ&nbsp;t&nbsp;v&nbsp;:<br/>
&nbsp;&nbsp;ELiftSubst.closed&nbsp;t&nbsp;=&nbsp;true&nbsp;-&gt;<br/>
&nbsp;&nbsp;EGlobalEnv.closed_env&nbsp;(trans_env&nbsp;Σ)&nbsp;=&nbsp;true&nbsp;-&gt;<br/>
&nbsp;&nbsp;EWellformed.wf_glob&nbsp;(trans_env&nbsp;Σ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;@Prelim.Ee.eval&nbsp;default_wcbv_flags&nbsp;(trans_env&nbsp;Σ)&nbsp;t&nbsp;v&nbsp;-&gt;<br/>
&nbsp;&nbsp;@Prelim.Ee.eval<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(EWcbvEval.disable_prop_cases&nbsp;opt_wcbv_flags)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(trans_env&nbsp;(OptimizePropDiscr.optimize_env&nbsp;Σ&nbsp;fgΣ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(EOptimizePropDiscr.optimize&nbsp;(EEnvMap.GlobalContextMap.make&nbsp;(trans_env&nbsp;Σ)&nbsp;(OptimizePropDiscr.trans_env_fresh_globals&nbsp;_&nbsp;fgΣ))&nbsp;t)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(EOptimizePropDiscr.optimize&nbsp;(EEnvMap.GlobalContextMap.make&nbsp;(trans_env&nbsp;Σ)&nbsp;(OptimizePropDiscr.trans_env_fresh_globals&nbsp;_&nbsp;fgΣ))&nbsp;v).<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;cl_t&nbsp;cl_env&nbsp;wfg&nbsp;ev.<br/>
&nbsp;&nbsp;rewrite&nbsp;OptimizePropDiscr.trans_env_optimize_env.<br/>
&nbsp;&nbsp;remember&nbsp;(EEnvMap.GlobalContextMap.make&nbsp;_&nbsp;_)&nbsp;as&nbsp;Σ0.<br/>
&nbsp;&nbsp;unshelve&nbsp;eapply&nbsp;(EOptimizePropDiscr.optimize_correct&nbsp;(fl&nbsp;:=&nbsp;default_wcbv_flags)&nbsp;(Σ&nbsp;:=&nbsp;Σ0));subst;cbn;eauto.<br/>
Qed.<br/>
<br/>
<br/>
Theorem&nbsp;extract_correct<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{EWellformed.EEnvFlags}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(wfl&nbsp;:=&nbsp;opt_wcbv_flags)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Σ&nbsp;:&nbsp;P.global_env_ext)&nbsp;(wfΣ&nbsp;:&nbsp;∥wf_ext&nbsp;Σ∥)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kn&nbsp;ui&nbsp;ind&nbsp;c&nbsp;ui'&nbsp;ignored&nbsp;exΣ&nbsp;:<br/>
&nbsp;&nbsp;axiom_free&nbsp;Σ&nbsp;-&gt;<br/>
&nbsp;&nbsp;welltyped&nbsp;Σ&nbsp;<span class="inlinecode"></span>&nbsp;(P.tConst&nbsp;kn&nbsp;ui)&nbsp;-&gt;<br/>
&nbsp;&nbsp;Σ&nbsp;p⊢&nbsp;P.tConst&nbsp;kn&nbsp;ui&nbsp;⇓&nbsp;P.tConstruct&nbsp;ind&nbsp;c&nbsp;ui'&nbsp;-&gt;<br/>
&nbsp;&nbsp;(isErasable&nbsp;Σ&nbsp;<span class="inlinecode"></span>&nbsp;(P.tConstruct&nbsp;ind&nbsp;c&nbsp;ui')&nbsp;-&gt;&nbsp;False)&nbsp;-&gt;<br/>
&nbsp;&nbsp;(forall&nbsp;k,&nbsp;ignored&nbsp;k&nbsp;=&nbsp;false)&nbsp;-&gt;<br/>
&nbsp;&nbsp;extract_pcuic_env<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(pcuic_args&nbsp;extract_within_coq)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Σ&nbsp;(wf_squash&nbsp;wfΣ)&nbsp;(KernameSet.singleton&nbsp;kn)&nbsp;ignored&nbsp;=&nbsp;Ok&nbsp;exΣ&nbsp;-&gt;<br/>
&nbsp;&nbsp;∥trans_env&nbsp;exΣ&nbsp;e⊢&nbsp;E.tConst&nbsp;kn&nbsp;⇓&nbsp;E.tConstruct&nbsp;ind&nbsp;c&nbsp;<span class="inlinecode"></span>∥.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;ax&nbsp;<span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode"><span class="id" title="var">wt</span></span>&nbsp;ev&nbsp;not_erasable&nbsp;no_ignores&nbsp;ex.<br/>
&nbsp;&nbsp;cbn&nbsp;-<span class="inlinecode"><span class="id" title="var">dearg_transform</span></span>&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;destruct&nbsp;dearg_transform&nbsp;eqn:dt;&nbsp;cbn&nbsp;-<span class="inlinecode"><span class="id" title="var">dearg_transform</span></span>&nbsp;in&nbsp;*;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">congruence</span></span>.<br/>
&nbsp;&nbsp;injection&nbsp;ex&nbsp;as&nbsp;-&gt;.<br/>
&nbsp;&nbsp;destruct&nbsp;wfΣ.<br/>
&nbsp;&nbsp;eapply&nbsp;erases_correct&nbsp;with&nbsp;(Σ'&nbsp;:=&nbsp;trans_env&nbsp;(Erasure.erase_global_decls_deps_recursive&nbsp;(PCUICAst.PCUICEnvironment.declarations&nbsp;Σ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(PCUICAst.PCUICEnvironment.universes&nbsp;Σ)&nbsp;_&nbsp;(wf_squash&nbsp;(sq&nbsp;w))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(KernameSet.singleton&nbsp;kn)&nbsp;ignored))&nbsp;in&nbsp;ev&nbsp;as&nbsp;(erv&amp;erase_to&amp;<span class="inlinecode"><span class="id" title="var">erev</span></span>);eauto.<br/>
&nbsp;&nbsp;+&nbsp;depelim&nbsp;erase_to;<span class="inlinecode">|<span class="id" title="var">easy</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;constructor.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;dearg_transform_correct;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;dt.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;(@OptimizePropDiscr.optimize_correct&nbsp;_&nbsp;default_wcbv_flags&nbsp;_&nbsp;_&nbsp;(tConst&nbsp;kn)&nbsp;(tConstruct&nbsp;ind&nbsp;c&nbsp;<span class="inlinecode"></span>));eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;remember&nbsp;(Erasure.erase_global_decls_deps_recursive&nbsp;_&nbsp;_&nbsp;_&nbsp;_&nbsp;_&nbsp;_)&nbsp;as&nbsp;eΣ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(EWellformed.wf_glob&nbsp;(trans_env&nbsp;eΣ))&nbsp;by&nbsp;now&nbsp;subst&nbsp;eΣ;eapply&nbsp;wf_erase_global_decls_recursive.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now&nbsp;apply&nbsp;EWellformed.wellformed_closed_env.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;eapply&nbsp;wf_erase_global_decls_recursive.<br/>
&nbsp;&nbsp;+&nbsp;eapply&nbsp;inversion_Const&nbsp;in&nbsp;wt&nbsp;as&nbsp;(?&amp;?&amp;?&amp;?&amp;?);&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;dt.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;global_erased_with_deps_erases_deps_tConst;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Σ&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">Σ0</span></span> <span class="inlinecode"><span class="id" title="var">univ_decls</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Σ0&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">univs</span></span> <span class="inlinecode"><span class="id" title="var">Σ1</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;wf_ext_wf&nbsp;in&nbsp;w&nbsp;as&nbsp;w1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;erase_global_decls_deps_recursive_correct;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;unfold&nbsp;PCUICAst.declared_constant&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cbn.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;?&nbsp;-&gt;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Print&nbsp;Assumptions&nbsp;extract_correct.&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
There are some assumptions of which almost all are in MetaCoq.
    From this project is only assume_env_wellformed assumption which is
    used to assume that the environments we extract are
    wellformed. MetaCoq's safe checker does not run from within Coq, so
    we cannot type check the environments. However, our environments
    are unquoted directly from Coq's kernel where they are already
    welltyped, so this is justified (and the same assumption is used in
    MetaCoq when they run their erasure).

<div class="paragraph"> </div>

    The rest of the assumptions are normal MetaCoq assumptions
    (which are justified in Coq Coq Correct!).

<div class="paragraph"> </div>

    <span class="inlinecode"><span class="id" title="var">JMeq.JMeq_eq</span></span> leaks from the use of some tactics and probably can be avoided.
 
</div>
<div class="code">
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
